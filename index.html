<!DOCTYPE HTML>
<html>
<head>
  <script>

    var gChartList = [];
    var gUSAPopulationDB = null;
    var gStateGeoGraphicInfoDB = null;
    var gHistoricalNameCountDB = null;
    var gNameList = null;
    var gWorkingName = ""
    var gWorkingNameDB = null;

    function requestfile(iLocalFilePath, oCallback) {
      const Http = new XMLHttpRequest();
      const url = iLocalFilePath;
      // const url = './db_generated/USAPopulationSummary.csv';
      Http.open("GET", url);
      Http.send();
      Http.onreadystatechange = (e) => {

        //dom = document.getElementById("textDisplay")
        //dom.innerText = Http.responseText
        if ("" != Http.responseText) {
          oCallback(Http.responseText);
        }
      }
    }

    function parseCSVtoDataset(iCSVString) {
      if ("" == iCSVString) {
        return [];
      }

      var wLines = iCSVString.split('\n');

      if (0 == wLines) {
        return [];
      }

      var wLineList = [];
      var wHeader = wLines[0].split(',');

      for (var i = 0; i < wHeader.length; ++i) {
        wLineList.push({ mName: wHeader[i], mData: [] });
      }

      for (var i = 1; i < wLines.length; ++i) {
        var wRow = wLines[i].split(',');

        for (var j = 0; j < wRow.length && j < wLineList.length; ++j) {
          wLineList[j].mData.push(wRow[j]);
        }
      }

      return wLineList
    }

    function getNameDatabase(name){
      var wFileName = "./db_generated/namepopulation/" + name.toLowerCase() + ".csv"
      requestfile(wFileName, function (iCSVString) {
        if ("" == iCSVString){
          gWorkingNameDB = null;
        }
        else {
          gWorkingNameDB = parseCSVtoDataset(iCSVString);
          gWorkingName = gWorkingNameDB[0].mData[0]
          wChart = createChart_XYear_YCount("NamePopulationChart", "USA Population with the name " + gWorkingName , gWorkingNameDB, 1, [2], false);
        }
      })
    }

    function createLineObject(iLineName, iData) {
      return {
        type: "line",
        name: iLineName,
        showInLegend: true,
        markerSize: 0,
        dataPoints: iData
      };
    }

    function checkPlotData(iIndexTocheck, iXAxisIndex, iYAxisIndices, iNeg=false){
       if (iXAxisIndex == iIndexTocheck) {
         return false;
       }
      
       if (0 == iYAxisIndices.length){
         if (true == iNeg) {
           return true;
          }
         return false;
       }
      
       for (var k = 0; k < iYAxisIndices.length; ++k) {
          if (iYAxisIndices[k] == iIndexTocheck) { 
              if (true == iNeg) {
                return false;
          }
       return true;
          }
       }
       
       if (true == iNeg) {
           return true;
          }
       return false;
    }
    
    function createChart_XYear_YCount(iDivContainerID, iTitle, iDataset, iXAxisIndex, iYAxisIndices, iNeg) {

      wDataSet = [];
      for (var i = 0; i < iDataset.length; ++i) {
          if (false == checkPlotData(i, iXAxisIndex, iYAxisIndices, iNeg)) {
            continue;
          }
          wPointList = [];
          wXData = iDataset[iXAxisIndex].mData;
          wYData = iDataset[i].mData;
          for (var k = 0; k < wYData.length; ++k) {
            wPointList.push({ x: new Date(parseInt(wXData[k]),00,01), y: parseInt(wYData[k]) });
          }
          wDataSet.push(createLineObject(iDataset[i].mName, wPointList));
      }

      var wChart = new CanvasJS.Chart(iDivContainerID, {
        title: {
          text: iTitle
        },
        axisX: {
          valueFormatString: "YYYY",
          crosshair: {
            enabled: true,
            snapToDataPoint: true
          }
        },
        axisY: {
          crosshair: {
            enabled: true
          }
        },
        toolTip: {
          shared: true
        },
        legend: {
          cursor: "pointer",
          verticalAlign: "top",
          horizontalAlign: "center",
          dockInsidePlotArea: true,
          itemclick: toogleDataSeries
        },
        data: wDataSet
      });
      wChart.render();
      gChartList.push(wChart);
      return wChart;
    }

    function toogleDataSeries(e) {
      if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
        e.dataSeries.visible = false;
      } else {
        e.dataSeries.visible = true;
      }
      for (var i = 0; i < gChartList.length; ++i) {
        gChartList.render();
      }
    }
/*
    function createColumnChart( iDivContainerID, iDataset,  iXAxisIndex, iYAxisIndices, iNeg, iXAxisValue) {
    
      var wDatasetIndex = -i;
      for (var i = 0; i < iDataset[iXAxisIndex].mData.length; ++i) {
        if ( iXAxisValue == iDataset[iXAxisIndex].mData.length)
        {
          wDatasetIndex = i;
        }
      }
      
      wDataSet = [];
      if (-1 != wDatasetIndex) {
      
      }
      
      wDataSet = [];
      for (var i = 0; i < iDataset.length; ++i) {
          if (false == checkPlotData(i, iXAxisIndex, iYAxisIndices, iNeg)) {
            continue;
          }
          wPointList = [];
          wXData = iDataset[iXAxisIndex].mData;
          wYData = iDataset[i].mData;
          for (var k = 0; k < wYData.length; ++k) {
            wPointList.push({ x: new Date(parseInt(wXData[k]),00,01), y: parseInt(wYData[k]) });
          }
          wDataSet.push(createLineObject(iDataset[i].mName, wPointList));
      }
    
        var chart = new CanvasJS.Chart("chartContainer",
    {
      title:{
        text: "Top Oil Reserves"
      },
      data: [

      {
        dataPoints: [
        { x: 1, y: 297571, label: "Venezuela"},
        { x: 2, y: 267017,  label: "Saudi" },
        { x: 3, y: 175200,  label: "Canada"},
        { x: 4, y: 154580,  label: "Iran"},
        { x: 5, y: 116000,  label: "Russia"},
        { x: 6, y: 97800, label: "UAE"},
        { x: 7, y: 20682,  label: "US"},
        { x: 8, y: 20350,  label: "China"}
        ]
      }
      ]
    });

    chart.render();
    }
    */

    window.onload = function () {
      requestfile("./db_generated/USAPopulationSummary.csv", function (iCSVString) {
        gUSAPopulationDB = parseCSVtoDataset(iCSVString);
        wChart = createChart_XYear_YCount("PopulationChart", "USA Social Security Number Issued per Year", gUSAPopulationDB, 1, [2, 3, 4, 5], false);
      })

      requestfile("./db_generated/stategeographyinfo.csv", function (iCSVString) {
        gStateGeoGraphicInfoDB = parseCSVtoDataset(iCSVString);
      })

      requestfile("./db_generated/historicalnamecount.csv", function (iCSVString) {
        gHistoricalNameCountDB = parseCSVtoDataset(iCSVString);
      })
      
      requestfile("./db_generated/namelist.csv", function (iCSVString) {
        gNameList = parseCSVtoDataset(iCSVString);
      })
      
      getNameDatabase("Wilson");
      
      gWorkingNameDB
    }

  </script>
</head>
<body>
  <textarea id="textDisplay"></textarea>
  <div id="PopulationChart" style="height: 370px; width: 100%;"></div>
  <div id="NamePopulationChart" style="height: 370px; width: 100%;"></div>
  <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>
